<header class="relative z-30 shrink-0 flex items-center justify-between px-4 sm:px-6 bg-white"
        style="height: 64px;
               border-bottom: 1.5px solid rgba(21,128,61,0.08);
               box-shadow: 0 1px 0 rgba(21,128,61,0.03), 0 2px 12px rgba(0,0,0,0.02);">

  <!-- ── GAUCHE ─────────────────────────────────────────────── -->
  <div class="flex items-center gap-2 sm:gap-3 min-w-0">

    <!-- Toggle sidebar -->
    <button (click)="toggleSidebar.emit()"
            class="w-9 h-9 rounded-xl flex items-center justify-center transition-all duration-200 shrink-0"
            style="color: #94a3b8;"
            onmouseover="this.style.background='rgba(21,128,61,0.08)'; this.style.color='#15803D'"
            onmouseout="this.style.background='transparent'; this.style.color='#94a3b8'">
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h7"/>
      </svg>
    </button>

    <!-- Séparateur -->
    <div class="w-px h-5 hidden sm:block" style="background: #e2e8f0;"></div>

    <!-- ── SÉLECTEUR BOUTIQUE (admin) ─────────────────────── -->
    @if (authService.isAdmin()) {
      <div class="flex items-center gap-2 sm:gap-2.5 min-w-0">

        <!-- Select custom -->
        <div class="relative min-w-0">
          <div class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none z-10 hidden sm:block"
               style="color: #15803D;">
            <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
            </svg>
          </div>
          <select (change)="onBoutiqueChange($event)"
                  class="appearance-none outline-none cursor-pointer text-sm font-semibold
                         rounded-xl transition-all duration-200 bg-white topbar-select"
                  style="padding: 8px 28px 8px 12px;
                         border: 1.5px solid rgba(21,128,61,0.18);
                         color: #15803D;
                         box-shadow: 0 1px 4px rgba(21,128,61,0.08);">
            <option value="">Toutes les boutiques</option>
            @for (boutique of boutiques; track boutique.id) {
              <option [value]="boutique.id">{{ boutique.nom }}</option>
            }
          </select>
          <div class="absolute right-2.5 top-1/2 -translate-y-1/2 pointer-events-none"
               style="color: #15803D;">
            <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
        </div>

        <!-- Badge boutique sélectionnée -->
        @if (selectedBoutique) {
          <span class="hidden sm:inline-flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-[11px] font-bold
                       text-white whitespace-nowrap"
                style="background: linear-gradient(135deg, #15803D 0%, #16a34a 100%);
                       box-shadow: 0 2px 8px rgba(21,128,61,0.28);">
            <span class="w-1.5 h-1.5 rounded-full bg-white/60"></span>
            {{ selectedBoutique.nom }}
          </span>
        } @else {
          <span class="hidden sm:inline-flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-[11px] font-semibold
                       whitespace-nowrap"
                style="background: #f1f5f9; color: #94a3b8;">
            <span class="w-1.5 h-1.5 rounded-full bg-slate-300"></span>
            Toutes
          </span>
        }
      </div>
    }

    <!-- Boutique gérant (non-admin) -->
    @if (!authService.isAdmin() && currentUser?.boutique) {
      <div class="flex items-center gap-2 min-w-0">
        <div class="inline-flex items-center gap-2 px-3 sm:px-3.5 py-2 rounded-xl text-xs sm:text-sm font-semibold truncate"
             style="background: rgba(21,128,61,0.07); color: #15803D;">
          <svg class="w-3.5 h-3.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
          </svg>
          <span class="truncate">{{ currentUser?.boutique?.nom }}</span>
        </div>
      </div>
    }
  </div>

  <!-- ── DROITE ─────────────────────────────────────────────── -->
  <div class="flex items-center gap-1.5 sm:gap-2.5 shrink-0">

    <!-- Badge rôle -->
    <span class="hidden sm:inline-flex items-center gap-1.5 px-3 py-1.5 rounded-xl
                 text-[11px] font-black uppercase tracking-wider"
          [style.background]="authService.isAdmin()
            ? 'linear-gradient(135deg, #fef9c3 0%, #fef08a 100%)'
            : 'rgba(21,128,61,0.07)'"
          [style.color]="authService.isAdmin() ? '#854d0e' : '#15803D'">
      @if (authService.isAdmin()) {
        <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor">
          <path d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm14 3c0 .6-.4 1-1 1H6c-.6 0-1-.4-1-1v-1h14v1z"/>
        </svg>
        Admin
      } @else {
        <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0
                   01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
        </svg>
        Gérant
      }
    </span>

    <!-- Séparateur -->
    <div class="w-px h-5 hidden sm:block" style="background: #e2e8f0;"></div>

    <!-- ── AVATAR + DROPDOWN ─────────────────────────────── -->
    <div class="relative">
      <button (click)="dropdownOpen = !dropdownOpen"
              class="flex items-center gap-2 sm:gap-2.5 px-1.5 sm:px-2 py-1.5 rounded-xl transition-all duration-200"
              style="outline: none;"
              onmouseover="this.style.background='#f8fafc'"
              onmouseout="this.style.background='transparent'">

        <!-- Avatar -->
        <div class="relative">
          @if (currentUser?.photo) {
            <img [src]="'http://localhost:8000/storage/' + currentUser?.photo"
                 class="w-8 h-8 rounded-xl object-cover"
                 style="box-shadow: 0 2px 6px rgba(0,0,0,0.12);" />
          } @else {
            <div class="w-8 h-8 rounded-xl flex items-center justify-center
                        text-xs font-black text-white"
                 style="background: linear-gradient(135deg, #0a1f13 0%, #15803D 100%);
                        box-shadow: 0 2px 8px rgba(21,128,61,0.30);">
              {{ getInitials() }}
            </div>
          }
          <!-- Indicateur online -->
          <div class="absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white"
               style="background: #4ade80; box-shadow: 0 0 5px rgba(74,222,128,0.60);">
          </div>
        </div>

        <!-- Nom + email -->
        <div class="text-left hidden md:block">
          <p class="text-[13px] font-bold leading-tight" style="color: #1e293b;">
            {{ currentUser?.nom }}
          </p>
          <p class="text-[11px] leading-tight" style="color: #94a3b8;">
            {{ currentUser?.email }}
          </p>
        </div>

        <!-- Chevron -->
        <svg class="w-3 h-3 transition-transform duration-200 hidden md:block"
             [class.rotate-180]="dropdownOpen"
             fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"
             style="color: #cbd5e1;">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>

      <!-- ── DROPDOWN MENU ───────────────────────────────── -->
      @if (dropdownOpen) {
        <div class="absolute right-0 bg-white rounded-2xl w-56 z-50 overflow-hidden"
             style="top: calc(100% + 10px);
                    box-shadow: 0 12px 40px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.06);
                    border: 1px solid rgba(0,0,0,0.06);">

          <!-- Header -->
          <div class="px-4 py-3"
               style="border-bottom: 1px solid #f1f5f9;
                      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);">
            <p class="text-[13px] font-bold" style="color: #1e293b;">{{ currentUser?.nom }}</p>
            <p class="text-[11px] truncate" style="color: #64748b;">{{ currentUser?.email }}</p>
          </div>

          <div class="py-1.5">
            <a routerLink="/profile" (click)="dropdownOpen = false"
               class="flex items-center gap-3 px-4 py-2.5 transition-colors"
               style="color: #475569;"
               onmouseover="this.style.background='#f8fafc'"
               onmouseout="this.style.background='transparent'">
              <div class="w-7 h-7 rounded-lg flex items-center justify-center"
                   style="background: #f1f5f9;">
                <svg class="w-3.5 h-3.5" style="color: #64748b;" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
              </div>
              <span class="text-sm font-medium">Mon profil</span>
            </a>

            @if (authService.isAdmin()) {
              <a routerLink="/users" (click)="dropdownOpen = false"
                 class="flex items-center gap-3 px-4 py-2.5 transition-colors"
                 style="color: #475569;"
                 onmouseover="this.style.background='#f8fafc'"
                 onmouseout="this.style.background='transparent'">
                <div class="w-7 h-7 rounded-lg flex items-center justify-center"
                     style="background: #f1f5f9;">
                  <svg class="w-3.5 h-3.5" style="color: #64748b;" fill="none" viewBox="0 0 24 24"
                       stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                  </svg>
                </div>
                <span class="text-sm font-medium">Utilisateurs</span>
              </a>
            }
          </div>

          <div style="border-top: 1px solid #f1f5f9;" class="py-1.5">
            <button (click)="logout()"
                    class="w-full flex items-center gap-3 px-4 py-2.5 transition-colors"
                    style="color: #ef4444;"
                    onmouseover="this.style.background='#fef2f2'"
                    onmouseout="this.style.background='transparent'">
              <div class="w-7 h-7 rounded-lg flex items-center justify-center"
                   style="background: #fef2f2;">
                <svg class="w-3.5 h-3.5 text-red-400" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round"
                        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                </svg>
              </div>
              <span class="text-sm font-medium">Déconnexion</span>
            </button>
          </div>
        </div>

        <!-- Overlay fermeture -->
        <div class="fixed inset-0 z-40" (click)="dropdownOpen = false"></div>
      }
    </div>
  </div>
</header>

<style>
  /* ── Responsive select ── */
  .topbar-select {
    min-width: 195px;
    padding-left: 34px !important;
  }
  @media (max-width: 640px) {
    .topbar-select {
      min-width: 140px;
      font-size: 12px;
      padding-left: 12px !important;
    }
  }
</style>
