<!-- ══════════════════════════════════════════════════════════ -->
<!-- COMMANDES — LISTE                                        -->
<!-- Palette: #15803D + white · Design: Biosen100 system      -->
<!-- ══════════════════════════════════════════════════════════ -->

<div class="min-h-screen" style="background: #ffffff;">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-5 sm:py-6">

    <!-- ══ HEADER ════════════════════════════════════════ -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6 sm:mb-7">
      <div>
        <div class="flex items-center gap-3 mb-1">
          <div class="w-10 h-10 sm:w-11 sm:h-11 rounded-2xl flex items-center justify-center shrink-0"
               style="background: rgba(21,128,61,0.08);">
            <svg class="w-5 h-5 sm:w-[22px] sm:h-[22px] text-[#15803D]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl sm:text-[28px] font-black text-gray-900 tracking-tight">Commandes</h1>
            <p class="text-sm sm:text-[15px] text-gray-400 font-medium">Gérer toutes les commandes</p>
          </div>
        </div>
      </div>
      <a routerLink="/commandes/create"
         class="inline-flex items-center justify-center gap-2.5 px-5 sm:px-6 py-3 sm:py-3.5
                text-white text-sm sm:text-[15px] font-bold tracking-wide rounded-2xl
                transition-all duration-200 active:scale-[0.97] shrink-0"
         style="background: linear-gradient(145deg, #15803D 0%, #1a9d4a 100%);
                box-shadow: 0 4px 16px rgba(21,128,61,0.25), 0 2px 4px rgba(21,128,61,0.12);">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"/>
        </svg>
        Nouvelle commande
      </a>
    </div>

    <!-- ══ MESSAGES ══════════════════════════════════════ -->

    <!-- ✅ SUCCÈS -->
    @if (successMessage) {
      <div class="mb-5 sm:mb-6 rounded-2xl overflow-hidden border border-[#15803D]/20"
           style="background: linear-gradient(135deg, #f0fdf4 0%, #f7fdf9 100%);
                  box-shadow: 0 2px 12px rgba(21,128,61,0.08);">
        <div class="flex items-center gap-3 px-4 sm:px-5 py-3.5">
          <div class="w-9 h-9 sm:w-10 sm:h-10 rounded-xl flex items-center justify-center shrink-0"
               style="background: linear-gradient(135deg, #15803D 0%, #16a34a 100%);
                      box-shadow: 0 3px 10px rgba(21,128,61,0.30);">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
            </svg>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-[11px] sm:text-xs font-black text-[#15803D] uppercase tracking-wider">Succès</p>
            <p class="text-sm sm:text-[15px] font-semibold text-[#15803D] mt-0.5">{{ successMessage }}</p>
          </div>
          <div class="w-1 h-10 rounded-full shrink-0" style="background: linear-gradient(180deg, #15803D, #86efac);"></div>
        </div>
      </div>
    }

    <!-- ❌ ERREUR -->
    @if (errorMessage) {
      <div class="mb-5 sm:mb-6 rounded-2xl overflow-hidden border border-red-200"
           style="background: linear-gradient(135deg, #fef2f2 0%, #fff5f5 100%);
                  box-shadow: 0 2px 12px rgba(239,68,68,0.08);">
        <div class="flex items-center gap-3 px-4 sm:px-5 py-3.5">
          <div class="w-9 h-9 sm:w-10 sm:h-10 rounded-xl flex items-center justify-center shrink-0"
               style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                      box-shadow: 0 3px 10px rgba(239,68,68,0.30);">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-[11px] sm:text-xs font-black text-red-500 uppercase tracking-wider">Erreur</p>
            <p class="text-sm sm:text-[15px] font-semibold text-red-700 mt-0.5">{{ errorMessage }}</p>
          </div>
          <div class="w-1 h-10 rounded-full shrink-0" style="background: linear-gradient(180deg, #ef4444, #fca5a5);"></div>
        </div>
      </div>
    }

    <!-- ══ NAVIGATION RAPIDE ════════════════════════════ -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-5 sm:mb-6">

      <!-- Aujourd'hui -->
      <a routerLink="/commandes/today"
         class="group relative overflow-hidden rounded-2xl p-4 sm:p-5 border-2 border-[#15803D]/15
                bg-[#f7faf7] hover:border-[#15803D]/30 hover:bg-[#15803D]/5
                transition-all duration-200 active:scale-[0.97]"
         style="box-shadow: 0 1px 3px rgba(21,128,61,0.04);">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 sm:w-11 sm:h-11 rounded-xl flex items-center justify-center shrink-0
                      bg-purple-100 text-purple-600 group-hover:bg-purple-600 group-hover:text-white
                      transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
          </div>
          <div class="min-w-0">
            <p class="text-sm sm:text-[15px] font-bold text-gray-900 truncate">Aujourd'hui</p>
            <p class="text-[11px] sm:text-xs text-gray-400 font-medium">Commandes du jour</p>
          </div>
        </div>
      </a>

      <!-- En cours -->
      <a routerLink="/commandes/en-cours"
         class="group relative overflow-hidden rounded-2xl p-4 sm:p-5 border-2 border-[#15803D]/15
                bg-[#f7faf7] hover:border-[#15803D]/30 hover:bg-[#15803D]/5
                transition-all duration-200 active:scale-[0.97]"
         style="box-shadow: 0 1px 3px rgba(21,128,61,0.04);">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 sm:w-11 sm:h-11 rounded-xl flex items-center justify-center shrink-0
                      bg-blue-100 text-blue-600 group-hover:bg-blue-600 group-hover:text-white
                      transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <div class="min-w-0">
            <p class="text-sm sm:text-[15px] font-bold text-gray-900 truncate">En cours</p>
            <p class="text-[11px] sm:text-xs text-gray-400 font-medium">À traiter</p>
          </div>
        </div>
      </a>

      <!-- Validées -->
      <a routerLink="/commandes/validees"
         class="group relative overflow-hidden rounded-2xl p-4 sm:p-5 border-2 border-[#15803D]/15
                bg-[#f7faf7] hover:border-[#15803D]/30 hover:bg-[#15803D]/5
                transition-all duration-200 active:scale-[0.97]"
         style="box-shadow: 0 1px 3px rgba(21,128,61,0.04);">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 sm:w-11 sm:h-11 rounded-xl flex items-center justify-center shrink-0
                      bg-[#15803D]/10 text-[#15803D] group-hover:bg-[#15803D] group-hover:text-white
                      transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <div class="min-w-0">
            <p class="text-sm sm:text-[15px] font-bold text-gray-900 truncate">Validées</p>
            <p class="text-[11px] sm:text-xs text-gray-400 font-medium">Terminées</p>
          </div>
        </div>
      </a>

      <!-- Annulées -->
      <a routerLink="/commandes/annulees"
         class="group relative overflow-hidden rounded-2xl p-4 sm:p-5 border-2 border-[#15803D]/15
                bg-[#f7faf7] hover:border-[#15803D]/30 hover:bg-[#15803D]/5
                transition-all duration-200 active:scale-[0.97]"
         style="box-shadow: 0 1px 3px rgba(21,128,61,0.04);">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 sm:w-11 sm:h-11 rounded-xl flex items-center justify-center shrink-0
                      bg-red-100 text-red-500 group-hover:bg-red-500 group-hover:text-white
                      transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <div class="min-w-0">
            <p class="text-sm sm:text-[15px] font-bold text-gray-900 truncate">Annulées</p>
            <p class="text-[11px] sm:text-xs text-gray-400 font-medium">Refusées</p>
          </div>
        </div>
      </a>
    </div>

    <!-- ══ FILTRES : RECHERCHE + DATE ═══════════════════ -->
    <div class="rounded-2xl p-4 sm:p-5 mb-5 sm:mb-6 border border-[#15803D]/8 bg-[#f7faf7]"
         style="box-shadow: 0 1px 3px rgba(21,128,61,0.04);">
      <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
        <!-- Recherche texte -->
        <div class="flex-1">
          <label class="block text-[11px] sm:text-xs font-black text-gray-500 mb-2 uppercase tracking-[0.10em]">
            Rechercher
          </label>
          <div class="relative group">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none
                        group-focus-within:text-[#15803D] transition-colors duration-200">
              <svg class="w-[18px] h-[18px]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </div>
            <input type="text"
                   [(ngModel)]="searchQuery"
                   (ngModelChange)="onSearchChange()"
                   placeholder="N° commande, nom client, téléphone..."
                   class="w-full pl-12 pr-5 py-3.5 bg-white border-2 border-[#15803D]/10 rounded-2xl
                          text-sm text-gray-800 placeholder-gray-400 transition-all duration-200 outline-none
                          focus:border-[#15803D]/40 focus:shadow-[0_0_0_4px_rgba(21,128,61,0.06)]"/>
          </div>
        </div>
        <!-- Filtre par date -->
        <div class="sm:w-52">
          <label class="block text-[11px] sm:text-xs font-black text-gray-500 mb-2 uppercase tracking-[0.10em]">
            Filtrer par date
          </label>
          <div class="relative group">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none
                        group-focus-within:text-[#15803D] transition-colors duration-200">
              <svg class="w-[18px] h-[18px]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
            <input type="date"
                   [(ngModel)]="selectedDate"
                   (ngModelChange)="onDateChange()"
                   class="w-full pl-12 pr-4 py-3.5 bg-white border-2 border-[#15803D]/10 rounded-2xl
                          text-sm text-gray-800 transition-all duration-200 outline-none cursor-pointer
                          focus:border-[#15803D]/40 focus:shadow-[0_0_0_4px_rgba(21,128,61,0.06)]"/>
          </div>
        </div>
        <!-- Bouton reset -->
        @if (searchQuery || selectedDate) {
          <div class="sm:self-end">
            <button type="button" (click)="resetFilters()"
                    class="w-full sm:w-auto px-4 py-3.5 rounded-2xl text-xs font-bold text-gray-500
                           bg-white border-2 border-[#15803D]/10 hover:border-red-200 hover:text-red-500
                           hover:bg-red-50 transition-all duration-200 active:scale-[0.97]
                           flex items-center justify-center gap-2">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
              </svg>
              Effacer
            </button>
          </div>
        }
      </div>
    </div>

    <!-- ══ TABLEAU ══════════════════════════════════════ -->
    <div class="rounded-2xl border border-[#15803D]/8 bg-[#f7faf7] overflow-hidden"
         style="box-shadow: 0 1px 3px rgba(21,128,61,0.04);">

      <!-- LOADING -->
      @if (loading) {
        <div class="flex flex-col items-center justify-center py-16 sm:py-20 gap-3">
          <div class="w-10 h-10 rounded-full border-[3px] border-[#15803D] border-t-transparent animate-spin"></div>
          <p class="text-sm text-gray-400 font-medium">Chargement des commandes...</p>
        </div>

      <!-- VIDE -->
      } @else if (commandes.length === 0) {
        <div class="flex flex-col items-center justify-center py-16 sm:py-20 gap-3">
          <div class="w-16 h-16 rounded-2xl flex items-center justify-center"
               style="background: rgba(21,128,61,0.06);">
            <svg class="w-8 h-8 text-[#15803D]/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
          </div>
          <p class="text-sm sm:text-[15px] text-gray-400 font-medium">Aucune commande trouvée</p>
        </div>

      <!-- DONNÉES -->
      } @else {

        <!-- Desktop Table -->
        <div class="hidden md:block overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr style="background: rgba(21,128,61,0.04); border-bottom: 1.5px solid rgba(21,128,61,0.08);">
                <th class="px-5 lg:px-6 py-3.5 text-left text-[11px] font-black text-gray-500 uppercase tracking-wider">N° Commande</th>
                <th class="px-5 lg:px-6 py-3.5 text-left text-[11px] font-black text-gray-500 uppercase tracking-wider">Client</th>
                <th class="px-5 lg:px-6 py-3.5 text-left text-[11px] font-black text-gray-500 uppercase tracking-wider">Employé</th>
                <th class="px-5 lg:px-6 py-3.5 text-left text-[11px] font-black text-gray-500 uppercase tracking-wider">Type</th>
                <th class="px-5 lg:px-6 py-3.5 text-right text-[11px] font-black text-gray-500 uppercase tracking-wider">Total</th>
                <th class="px-5 lg:px-6 py-3.5 text-center text-[11px] font-black text-gray-500 uppercase tracking-wider">Statut</th>
                <th class="px-5 lg:px-6 py-3.5 text-center text-[11px] font-black text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (commande of commandes; track commande.id) {
                <tr class="hover:bg-[#15803D]/3 transition-colors duration-150"
                    style="border-bottom: 1px solid rgba(21,128,61,0.05);">

                  <td class="px-5 lg:px-6 py-4">
                    <p class="text-sm font-bold text-gray-900">{{ commande.numero_commande }}</p>
                    <p class="text-[11px] text-gray-400 mt-0.5">{{ commande.date_commande | date:'dd/MM/yyyy HH:mm' }}</p>
                  </td>

                  <td class="px-5 lg:px-6 py-4">
                    @if (commande.client) {
                      <p class="text-sm font-semibold text-gray-800">{{ commande.client.nom_complet }}</p>
                      <p class="text-[11px] text-gray-400 mt-0.5">{{ commande.client.telephone }}</p>
                    } @else {
                      <span class="text-sm text-gray-400 italic">Sans client</span>
                    }
                  </td>

                  <td class="px-5 lg:px-6 py-4 text-sm text-gray-600 font-medium">
                    {{ commande.employe?.nom }}
                  </td>

                  <td class="px-5 lg:px-6 py-4">
                    <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-xs font-bold"
                          [style.background]="commande.type_commande === 'livraison' ? 'rgba(21,128,61,0.08)' : 'rgba(107,114,128,0.08)'"
                          [style.color]="commande.type_commande === 'livraison' ? '#15803D' : '#4b5563'">
                      @if (commande.type_commande === 'livraison') {
                        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"/>
                        </svg>
                        Livraison
                      } @else {
                        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-4 0a2 2 0 110-4 2 2 0 010 4z"/>
                        </svg>
                        Sur place
                      }
                    </span>
                  </td>

                  <td class="px-5 lg:px-6 py-4 text-right">
                    <p class="text-sm font-black text-gray-900">{{ commande.total | number:'1.0-0' }} F</p>
                  </td>

                  <td class="px-5 lg:px-6 py-4 text-center">
                    <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-xs font-bold"
                          [ngClass]="{
                            'bg-blue-100 text-blue-700': commande.statut === 'en_cours',
                            'bg-[#15803D]/10 text-[#15803D]': commande.statut === 'validee',
                            'bg-red-100 text-red-600': commande.statut === 'annulee',
                            'bg-gray-100 text-gray-600': commande.statut !== 'en_cours' && commande.statut !== 'validee' && commande.statut !== 'annulee'
                          }">
                      <span class="w-1.5 h-1.5 rounded-full"
                            [ngClass]="{
                              'bg-blue-500': commande.statut === 'en_cours',
                              'bg-[#15803D]': commande.statut === 'validee',
                              'bg-red-500': commande.statut === 'annulee',
                              'bg-gray-500': commande.statut !== 'en_cours' && commande.statut !== 'validee' && commande.statut !== 'annulee'
                            }">
                      </span>
                      {{ getStatutLabel(commande.statut) }}
                    </span>
                  </td>

                  <td class="px-5 lg:px-6 py-4">
                    <div class="flex items-center justify-center gap-1.5">
                      <a [routerLink]="['/commandes', commande.id]"
                         class="w-9 h-9 flex items-center justify-center rounded-xl text-[#15803D]
                                hover:bg-[#15803D]/8 transition-all duration-200"
                         title="Voir">
                        <svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                      </a>
                      @if (commande.statut !== 'annulee') {
                        <button (click)="openAnnulerModal(commande)"
                                class="w-9 h-9 flex items-center justify-center rounded-xl text-red-500
                                       hover:bg-red-50 transition-all duration-200"
                                title="Annuler">
                          <svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                          </svg>
                        </button>
                      }
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <!-- Mobile Cards -->
        <div class="md:hidden divide-y" style="border-color: rgba(21,128,61,0.06);">
          @for (commande of commandes; track commande.id) {
            <div class="p-4 hover:bg-[#15803D]/3 transition-colors duration-150">
              <div class="flex items-center justify-between mb-2.5">
                <div>
                  <p class="text-sm font-bold text-gray-900">{{ commande.numero_commande }}</p>
                  <p class="text-[11px] text-gray-400 mt-0.5">{{ commande.date_commande | date:'dd/MM/yyyy HH:mm' }}</p>
                </div>
                <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-xl text-[11px] font-bold"
                      [ngClass]="{
                        'bg-blue-100 text-blue-700': commande.statut === 'en_cours',
                        'bg-[#15803D]/10 text-[#15803D]': commande.statut === 'validee',
                        'bg-red-100 text-red-600': commande.statut === 'annulee',
                        'bg-gray-100 text-gray-600': commande.statut !== 'en_cours' && commande.statut !== 'validee' && commande.statut !== 'annulee'
                      }">
                  <span class="w-1.5 h-1.5 rounded-full"
                        [ngClass]="{
                          'bg-blue-500': commande.statut === 'en_cours',
                          'bg-[#15803D]': commande.statut === 'validee',
                          'bg-red-500': commande.statut === 'annulee',
                          'bg-gray-500': commande.statut !== 'en_cours' && commande.statut !== 'validee' && commande.statut !== 'annulee'
                        }">
                  </span>
                  {{ getStatutLabel(commande.statut) }}
                </span>
              </div>

              <div class="flex items-center justify-between mb-2">
                @if (commande.client) {
                  <div class="min-w-0 flex-1">
                    <p class="text-sm font-semibold text-gray-800 truncate">{{ commande.client.nom_complet }}</p>
                    <p class="text-[11px] text-gray-400">{{ commande.client.telephone }}</p>
                  </div>
                } @else {
                  <span class="text-sm text-gray-400 italic">Sans client</span>
                }
                <p class="text-sm font-black text-gray-900 shrink-0 ml-3">{{ commande.total | number:'1.0-0' }} F</p>
              </div>

              <div class="flex items-center justify-between mt-2.5">
                <div class="flex items-center gap-2">
                  <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-lg text-[11px] font-bold"
                        [style.background]="commande.type_commande === 'livraison' ? 'rgba(21,128,61,0.08)' : 'rgba(107,114,128,0.08)'"
                        [style.color]="commande.type_commande === 'livraison' ? '#15803D' : '#4b5563'">
                    @if (commande.type_commande === 'livraison') {
                      <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"/>
                      </svg>
                      Livraison
                    } @else {
                      <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-4 0a2 2 0 110-4 2 2 0 010 4z"/>
                      </svg>
                      Sur place
                    }
                  </span>
                  @if (commande.employe?.nom) {
                    <span class="text-[11px] text-gray-400 font-medium">· {{ commande.employe?.nom }}</span>
                  }
                </div>
                <div class="flex items-center gap-1">
                  <a [routerLink]="['/commandes', commande.id]"
                     class="w-8 h-8 flex items-center justify-center rounded-lg text-[#15803D]
                            hover:bg-[#15803D]/8 transition-all duration-200">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                    </svg>
                  </a>
                  @if (commande.statut !== 'annulee') {
                    <button (click)="openAnnulerModal(commande)"
                            class="w-8 h-8 flex items-center justify-center rounded-lg text-red-500
                                   hover:bg-red-50 transition-all duration-200">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                      </svg>
                    </button>
                  }
                </div>
              </div>
            </div>
          }
        </div>

        <!-- PAGINATION -->
        @if (pagination && pagination.last_page > 1) {
          <div class="px-4 sm:px-6 py-4 flex flex-col sm:flex-row items-center justify-between gap-3"
               style="border-top: 1.5px solid rgba(21,128,61,0.08);">
            <p class="text-xs sm:text-sm text-gray-500 font-medium">
              Affichage de <span class="font-bold text-gray-700">{{ pagination.from }}</span>
              à <span class="font-bold text-gray-700">{{ pagination.to }}</span>
              sur <span class="font-bold text-[#15803D]">{{ pagination.total }}</span> commandes
            </p>
            <div class="flex items-center gap-2">
              <button (click)="onPageChange(filters.page - 1)"
                      [disabled]="filters.page === 1"
                      class="px-4 py-2 border-2 border-[#15803D]/15 rounded-xl text-sm font-bold text-gray-600
                             hover:border-[#15803D]/30 hover:bg-[#15803D]/5
                             disabled:opacity-40 disabled:cursor-not-allowed transition-all duration-200">
                ← Précédent
              </button>
              <span class="px-3 py-2 rounded-xl text-sm font-black text-white min-w-[40px] text-center"
                    style="background: linear-gradient(145deg, #15803D, #1a9d4a);">
                {{ filters.page }}
              </span>
              <button (click)="onPageChange(filters.page + 1)"
                      [disabled]="filters.page === pagination.last_page"
                      class="px-4 py-2 border-2 border-[#15803D]/15 rounded-xl text-sm font-bold text-gray-600
                             hover:border-[#15803D]/30 hover:bg-[#15803D]/5
                             disabled:opacity-40 disabled:cursor-not-allowed transition-all duration-200">
                Suivant →
              </button>
            </div>
          </div>
        }
      }
    </div>

  </div>
</div>

<!-- ══════════════════════════════════════════════════════════ -->
<!-- MODAL ANNULATION                                          -->
<!-- ══════════════════════════════════════════════════════════ -->
@if (showAnnulerModal && commandeToAnnuler) {
  <div class="fixed inset-0 z-50 flex items-center justify-center p-4"
       style="background: rgba(0,0,0,0.40); backdrop-filter: blur(4px);">
    <div class="bg-white rounded-3xl max-w-md w-full overflow-hidden"
         style="box-shadow: 0 20px 60px rgba(0,0,0,0.15), 0 8px 20px rgba(0,0,0,0.08);"
         (click)="$event.stopPropagation()">

      <!-- Header -->
      <div class="px-6 pt-6 pb-4">
        <div class="flex items-center gap-3 mb-1">
          <div class="w-11 h-11 rounded-xl flex items-center justify-center shrink-0"
               style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                      box-shadow: 0 3px 10px rgba(239,68,68,0.25);">
            <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </div>
          <div>
            <h3 class="text-xl sm:text-[22px] font-black text-gray-900">Annuler la commande</h3>
            <p class="text-sm text-gray-400 font-medium mt-0.5">
              N° <span class="font-bold text-gray-600">{{ commandeToAnnuler.numero_commande }}</span>
            </p>
          </div>
        </div>
      </div>

      <div class="mx-6" style="height: 1px; background: rgba(239,68,68,0.10);"></div>

      <!-- Body -->
      <div class="px-6 py-5">
        <label class="block text-[11px] sm:text-xs font-black text-gray-500 mb-2.5 uppercase tracking-[0.10em]">
          Raison de l'annulation *
        </label>
        <textarea
          [(ngModel)]="raisonAnnulation"
          rows="3"
          placeholder="Ex: Client a changé d'avis, erreur de saisie..."
          class="w-full px-4 py-3.5 bg-[#f7faf7] border-2 border-red-200/60 rounded-2xl
                 text-sm sm:text-[15px] text-gray-800 placeholder-gray-400 transition-all duration-200 outline-none
                 focus:border-red-400 focus:bg-white focus:shadow-[0_0_0_4px_rgba(239,68,68,0.06)]
                 resize-none">
        </textarea>
      </div>

      <!-- Footer -->
      <div class="px-6 pb-6 flex items-center justify-end gap-3">
        <button (click)="showAnnulerModal = false"
                [disabled]="annulerLoading"
                class="px-5 py-3 text-sm font-bold text-gray-600 rounded-xl
                       hover:bg-gray-100 transition-all duration-200 disabled:opacity-50">
          Annuler
        </button>
        <button (click)="confirmAnnuler()"
                [disabled]="annulerLoading || !raisonAnnulation.trim()"
                class="px-5 py-3 text-white text-sm font-bold rounded-xl
                       flex items-center gap-2 transition-all duration-200
                       disabled:opacity-50 disabled:cursor-not-allowed active:scale-[0.97]"
                style="background: linear-gradient(145deg, #ef4444 0%, #dc2626 100%);
                       box-shadow: 0 4px 14px rgba(239,68,68,0.30);">
          @if (annulerLoading) {
            <span class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
          }
          Confirmer l'annulation
        </button>
      </div>
    </div>
  </div>
}
